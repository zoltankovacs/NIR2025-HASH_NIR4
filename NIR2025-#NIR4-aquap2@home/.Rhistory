# 0.) Launch "aquap2" package in R
library(aquap2) # load aqap2 package so we can use its functions
genFolderStr() # create the necessary folder structure ONCE!
exportSampleList() # create randomised measurement order
# 2.) Import data after experiment and copying all files on place
fullData <- gfd() # every detail of the spectral data is defined in the "metadata.R" file
# 3.) Plot raw spectra from imported dataset
plot(fullData, colorBy = c("C_adultConc", "C_Repl"))
plot(fullData, c("C_adultConc", "C_Repl"), pg.where = "")
plot(fullData, colorBy = c("C_adultConc", "C_Repl"), pg.where = "")
fullData
fullData$header$Y_conSNr
plot(fullData, colorBy = c("C_adultConc"), pg.where = "")
fullDataTr <- selectWls(fullData, 970, 1050)
plot(fullDataTr, colorBy = c("C_adultConc"), pg.where = "")
fullDataTr <- selectWls(fullData, 920, 1050)
plot(fullDataTr, colorBy = c("C_adultConc"), pg.where = "")
fullDataTr <- selectWls(fullData, 900, 1050)
plot(fullDataTr, colorBy = c("C_adultConc"), pg.where = "")
fullDataTr <- selectWls(fullData, 900, 950)
plot(fullDataTr, colorBy = c("C_adultConc"), pg.where = "")
fullData$NIR[1:5, 1:10]
which.max(fullDataTr[,7])
which.max(fullDataTr$NIR[,7])
fullData[31,]
# 4.) Remove unwanted data from our dataset
dataReduced <- ssc(fullData, C_smplName == "C030R2Had", include=FALSE) # use the "sub-select class" (ssc) function
plot_spectra(dataReduced, colorBy = "C_waterTemp", pg.where = "")
plot_spectra(dataReduced, colorBy = "C_adultConc", pg.where = "")
plot(fullData, colorBy = c("C_adultConc"), pg.where = "")
plot_spectra(dataReduced, colorBy = "C_adultConc", pg.where = "")
# 5.) Set analysis procedure file for the range of 950-1600 nm and plot using cube
## set in "matedata/anproc.r":
### spl.wl <- c("950-to-1600")
cu <- gdmm(dataReduced) # calculate PCA on the reduced dataset, then plot the results
plot_spectra(cu, colorBy = "C_adultConc", pg.where = "")
plot_spectra(cu, pg.fns = "_noOut") # "pg.fns" is to change the name of PDF not to overwrite previous ones
plot_spectra(cu, colorBy = "C_adultConc", pg.fns = "_noOut") # "pg.fns" is to change the name of PDF not to overwrite previous ones
# 6.) Do PCA on the dateset
## set in "matedata/anproc.r":
### do.pca <- TRUE
### pca.colorBy <- c("C_Water", "C_waterTemp")
cu2 <- gdmm(dataReduced)  # calculate PCA
plot(cu2)   # plot the results of PCA
# 6.) Do PCA on the dateset
## set in "matedata/anproc.r":
### do.pca <- TRUE
### pca.colorBy <- c("C_adultConc", "C_Repl", "C_conSNr", "C_SystemTemp")
cu2 <- gdmm(dataReduced)  # calculate PCA
plot(cu2)   # plot the results of PCA
# 7.) Analyses in different wavelength ranges and pretreatments
## set in "metadata/anproc.r":
### spl.wl <- c("680-to-800", "900-to-1040", "1300-to-1600")
### do.pca <- FALSE
cu3 <- gdmm(dataReduced)
# 6.) Do PCA on the dateset
## set in "matedata/anproc.r":
### do.pca <- TRUE
### pca.colorBy <- c("C_adultConc", "C_Repl", "C_conSNr", "C_SystemTemp")
cu2 <- gdmm(dataReduced)  # calculate PCA
plot(cu2)   # plot the results of PCA
# 7.) Analyses in different wavelength ranges and pretreatments
## set in "metadata/anproc.r":
### spl.wl <- c("900-to-1100", "1000-to-1400", "1300-to-1600")
### do.pca <- FALSE
cu3 <- gdmm(dataReduced)
plot_spectra(cu3, colorBy = "C_adultConc", pg.fns = "_byRange") # plot spectra
# 7a.) Set analysis procedure to do pre-treatment
## set in "metadata/anproc.r":
### dpt.pre <- "sgol@2-21-0"
cu3 <- gdmm(dataReduced)
plot_spectra(cu3, colorBy = "C_adultConc", pg.fns = "_byRange_sgol") # plot the results of PCA calculated
# 7b.) Set analysis procedure to do pre-treatment  and calculate PCA
## set in "metadata/anproc.r":
### dpt.post <- "msc"
### do.pca <- TRUE
cu4 <- gdmm(dataReduced)
plot_spectra(cu4, colorBy = "C_adultConc", pg.fns = "_byRange_sgol+msc") # plot the spectra
plot(cu4, pg.fns = "_byRange_sgol+msc") # plot the results of PCA calculated
# 7b.) Set analysis procedure to do pre-treatment  and calculate PCA
## set in "metadata/anproc.r":
### dpt.post <- "snv"
### do.pca <- TRUE
cu4 <- gdmm(dataReduced)
plot_spectra(cu4, colorBy = "C_adultConc", pg.fns = "_byRange_sgol+msc") # plot the spectra
plot(cu4, pg.fns = "_byRange_sgol+msc") # plot the results of PCA calculated
dataReduced
cu4
# 9.) Do regression on water temperature with PLSR
## set in "metadata/anproc.r":
### do.pca <- FALSE
### do.pls <- TRUE
### pls.ncomp <- 2 # set the number of latent variables (LV) to be used in the modelling
### pls.regOn <- c("Y_adultConc")  # variable to be predicted
### pls.valid <- "C_SampleNr"  # default: 10-fold cross-validation but it can be changed to active class
### pls.colorBy <- "C_adultConc" # colouring of the points
cu6 <- gdmm(dataReduced) # calculate PLSR
plot(cu6, pg.fns = "_sgol+msc") # plot the results of PLSR
# 10.) Create classic aquagrams and subtracted spectra
## set in "metadata/anproc.r":
### do.pls <- FALSE
### do.aqg <- TRUE
### spl.wl <- "1300-to-1600"
### aqg.vars <- "C_adultConc"
### aqg.mod <- "classic"
### aqg.spectra <- "all"
cu7 <- gdmm(dataReduced)
# 10.) Create classic aquagrams and subtracted spectra
## set in "metadata/anproc.r":
### do.pls <- FALSE
### do.aqg <- TRUE
### spl.wl <- "1300-to-1600"
### aqg.vars <- "C_adultConc"
### aqg.mod <- "classic"
### aqg.spectra <- "all"
cu7 <- gdmm(dataReduced)
dataReduced
# 10.) Create classic aquagrams and subtracted spectra
## set in "metadata/anproc.r":
### do.pls <- FALSE
### do.aqg <- TRUE
### spl.wl <- "1300-to-1600"
### aqg.vars <- "C_adultConc"
### aqg.mod <- "classic"
### aqg.spectra <- "all"
cu7 <- gdmm(dataReduced)
getWavelengths(fullData)
# 10.) Create classic aquagrams and subtracted spectra
## set in "metadata/anproc.r":
### do.pls <- FALSE
### do.aqg <- TRUE
### spl.wl <- "1300-to-1600"
### aqg.vars <- "C_adultConc"
### aqg.mod <- "classic"
### aqg.spectra <- "all"
### aqg.selWls <- c(1342.1908, 1364.4160, 1373.2525, 1383.1570, 1410.4663, 1425.6289, 1440.6978, 1452.4719, 1460.9985, 1475.8464, 1488.4986, 1511.5154)
cu7 <- gdmm(dataReduced)
# 10.) Create classic aquagrams and subtracted spectra
## set in "metadata/anproc.r":
### do.pls <- FALSE
### do.aqg <- TRUE
### spl.wl <- "1300-to-1600"
### aqg.vars <- "C_adultConc"
### aqg.mod <- "classic"
### aqg.spectra <- "all"
### aqg.selWls <- c(1342.1908, 1364.4160, 1373.2525, 1383.1570, 1410.4663, 1425.6289, 1440.6978, 1452.4719, 1460.9985, 1475.8464, 1488.4986, 1511.5154)
cu7 <- gdmm(dataReduced)
plot(cu7, pg.fns = "") # plot "classic" aquagram
